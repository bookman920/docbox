## GIP0001 虚拟物品的发行和交易

Layer: Consensus

Title: Virtual Props' Publish and Trade

Status: Draft V0.1

Author：bookman

Type: Standards Track

Created: 2018-04-24

Summary：提出了涵盖虚拟物品的发行、转移、竞价销售、熔铸功能的完整解决方案，将于主链发布之日默认激活。

### 概述
1、CP Register：生产者注册信息
2、CP Change：生产者修改信息/转移注册信息所有权
3、VP Create：生产者发行虚拟物品，VP被制造出来，处于Produce状态，可以进入Exchange状态，也可以进入Found状态
4、VP Exchange：VP在生产者和用户、用户和用户间转移，可以在Exchange状态上自循环，也可以进入Sale或Found状态
5、VP Sale：VP被出售，进入Sale状态（竞价环节），可以自循环（通过Buy操作多轮竞价）。无论成功与否，最终都将回到Exchange状态
6、VP Found：VP被熔铸为Coin，进入零钱包，这是终极状态，VP除币值外的所有属性被不可逆转的抹除

虚拟物品状态机如下所示：
    _________________________________
   /                                 |
  /                                  ↓
Produce -->  Exchange --> Sale     Found
             ↑  | | ↑     ↑ ||       ↑
             |  | | |     |_||       |
             |__| | |________|       | 
                  |__________________|

### cp.list

查询系统中现有的所有CP列表：cp.list

#### 可访问性

- 开放式连接器 N - 授权式连接器 Y - 控制台连接器 Y -

#### Example Request

```js
let cps = await connect.execute({method:'cp.list', params:[]});
for (i = 0; i < cps.length; i++) {
    console.log(cps[i]);
}
```

#### Example Response

Property | Description
---|---
cid             |  CP唯一编号，由系统内部分配
name            |  CP的名称，由注册者设定，全局唯一
url             |  CP的URL地址
ip              |  CP的IP地址，可以为空
current.hash    |  注册信息所在交易的哈希
current.index   |  注册信息在交易中的序列号
current.address |  注册信息关联的地址
owned           |  是否归属于当前钱包（仅对钱包客户端有效）
status          |  保留字段

```json
[
  {
    "cid": "237da570-b725-11e8-a7ca-3f8b903ba033",
    "name": "hello",
    "url": "127.0.0.1",
    "ip": "",
    "current": {
      "hash": "bd3a3656b94fd9d61ca7a3721c385e29e4b12176b9efa8fe0702ee5b95ff25c4",
      "index": 0,
      "address": "tb1qr790zz32jyyje8letxkavdv93qf7dmp0wjx3s0"
    },
    "owned": true,
    "status": 1
  }
]
```

### token.auth

终端令牌制备指令： token.auth cpids
@note： cpids 为逗分字符串，可携带一条或多条CPID信息

#### 可访问性

- 开放式连接器 N - 授权式连接器 Y - 控制台连接器 Y -

#### Example Request

```js
let cps = await connect.execute({method:'token.auth', params:[1111,2222]});
```

#### Example Response

null

@note 控制台屏显内容：
1111: 038253ce66d5615a6efe9f262c2e96a305f9fab5e9ebb39688c55919b784fb8f88
2222: 024cc9367ef61ab6f5842f50c50717434255a6427e2a3e3486f39000f8d4fce2ac
3333: 03e434d1b87c191d31535a82adfb33c81fb2d1a56a3a5f9182673e92631382698b

### cp.create

CP注册指令：cp.create "name" "url" ["ip"]

@note: 
    注册成功后，生产者由系统生成的全局唯一编码 cid 所标识，称为CP编码
    name 由汉字、大小写字母、数字、下划线和点组成的标识字符串，长度4~20，必须是全局唯一的，不可重复
    ip是可选项，但是结合ip注册，可以得到类似域名寻址的效果，或者说，可以作为 .gamegold 的DNS替代服务使用
    共识变量 registerFee 决定了注册费用，这笔费用被系统冻结无人可以花费
    *该指令一般在主节点管理后台/控制台执行

#### 可访问性

- 开放式连接器 N - 授权式连接器 Y - 控制台连接器 Y -

#### Example Request

入口参数

Property | Description
---|---
name    |  CP名称
url     |  CP的URL地址
[ip]    |  CP的IP地址

```js
    let ret = await connector.execute('cp.create', [uuid(), '127.0.0.1', '127.0.0.1']);
    console.log(ret);
```

#### Example Response
```json
{
  "name": "testfellow3",                                                     //CP名称
  "url": "http://920.cc",                                                    //URL地址
  "ip": "",                                                                  //IP地址       
  "cid": "0a021c00-bb23-11e8-8848-233ceb544c5d",                             //CP编码
  "oper": "cpRegister",                                                      //操作类型
  "txid": "412408ea931b6b8942c8fd865c1a6da46899b0ef30522884ba0b05d5b704dcdc" //CP记录所在交易的哈希，小端格式
}

```

### cp.change

CP修改/转让指令： cp.change "name" ["url" "ip" "addr"]

@note:
    可以只修改名称，但修改后的名称必须全局唯一，而被修改掉的名字将可以被他人再次利用
    如果输入了 addr ，则表示向该地址转让注册信息
    修改、转让没有额外的手续费用
    *该指令一般在主节点管理后台/控制台执行，而非在钱包上执行

#### Example Request

入口参数

Property | Description
---|---
name    |  CP名称
[url]   |  CP的URL地址
[ip]    |  CP的IP地址
[addr]  |  新的接收地址，！！！若填充此字段，相当于转让CP所有权

```js
    let ret = await connector.execute('cp.change', ['testfellow2', 'bookman.cc']);
    console.log(ret);
```

#### Example Response
```json
{
  "name": "test1",                                                            //CP原有名称
  "newName": "test2",                                                         //CP新的名称
  "url": "http://gamegold.xin",                                               //CP最新的URL
  "ip": "",                                                                   //CP最新的IP
  "addr": "tb1qf0md5h9erhqwfwcrshdhkfpg93h0hz2jwk6rwm",                       //CP最新的地址
  "cid": "9c998be0-bb26-11e8-948a-33c872827589",                              //CP编码
  "oper": "cpChange",                                                         //操作类型
  "txid": "92b1ec0a161f2554d0404cce7a10f70050616e304758e3de0338a10b2f172e41"  //CP记录所在交易的哈希，小端格式
}
```
